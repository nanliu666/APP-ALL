<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <title>首页</title>
    <link href="css/mui.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/common/common.css" />
    <link rel="stylesheet" href="css/bootstrap.css">
    <link rel="stylesheet" href="css/index.css" />
</head>

<body>
    <!-- nav -->
    <nav class="mui-bar mui-bar-tab" id="nav">
        <a id="tab_home" class="mui-tab-item actives" href="index.html">
            <img src="images/common/index.svg" style="display: none;" />
            <img src="images/common/index_light.svg" />
            <span class="mui-tab-label">首页</span>
        </a>
        <a id="tab_message" class="mui-tab-item" href="games.html">
            <img src="images/common/game.svg" />
            <img src="images/common/game_light.svg" style="display: none;" />
            <span class="mui-tab-label">游戏</span>
        </a>
        <a id="tab_contact" class="mui-tab-item" href="gifts.html">
            <img src="images/common/gift.svg" />
            <img src="images/common/gift_light.svg" style="display: none;" />
            <span class="mui-tab-label">礼包</span>
        </a>
        <a id="tab_setting" class="mui-tab-item" href="zhao.html">
            <img src="images/common/zhao.svg" />
            <img src="images/common/zhao_light.svg" style="display: none;" />
            <span class="mui-tab-label">招聘</span>
        </a>
        <a id="tab_about" class="mui-tab-item" href="about.html">
            <img src="images/common/about.svg" style="margin-top: .6rem;" />
            <img src="images/common/about_light.svg" style="display: none;margin-top: .1rem;" />
            <span class="mui-tab-label">关于</span>
        </a>
    </nav>

    <div class="mui-content">
        <div class="topInfo">
            <img src="images/logo (2).png" class="logo" />
            <span style="float: right">
                <span class="mui-icon mui-icon-contact" id="JSCenter" style="font-size:38px; padding: 10px"></span>
            </span>
        </div>
        <div id="slider" class="mui-slider">
            <div class="mui-slider-group mui-slider-loop">
                <!-- 额外增加的一个节点(循环轮播：第一个节点是最后一张轮播) -->
                <div class="mui-slider-item mui-slider-item-duplicate">
                    <a href="javascript:;">
                        <img src="images/banner3.png">
                    </a>
                </div>
                <!-- 第一张 -->
                <div class="mui-slider-item">
                    <a href="javascript:;">
                        <img src="images/banner1.png">
                    </a>
                </div>
                <!-- 第二张 -->
                <div class="mui-slider-item">
                    <a href="javascript:;">
                        <img src="images/banner2.png">
                    </a>
                </div>
                <!-- 第三张 -->
                <div class="mui-slider-item">
                    <a href="javascript:;">
                        <img src="images/banner3.png">
                    </a>
                </div>
                <!-- 额外增加的一个节点(循环轮播：最后一个节点是第一张轮播) -->
                <div class="mui-slider-item mui-slider-item-duplicate">
                    <a href="javascript:;">
                        <img src="images/banner1.png">
                    </a>
                </div>
            </div>
            <div class="mui-slider-indicator">
                <div class="mui-indicator mui-active"></div>
                <div class="mui-indicator"></div>
                <div class="mui-indicator"></div>
            </div>
        </div>

        <div class="list">
            <div class="top_list">
                <p>今日推荐<a href="games.html" style="color:#1296db!important;">查看全部</a></p>
            </div>
            <ul class="list_Body"></ul>
        </div>
        <div id="tableBox">
            <div class="tabBar">
                <ul class="tabLi">
                    <li class="active tb1">开服表</li>
                    <li>新游榜</li>
                </ul>
            </div>
            <div class="tb " id="tb1">
                <table class="table  table-responsive" style="background-color: white">
                    <thead>
                        <tr>
                            <td class="tableHeadTD">开服名称</td>
                            <td class="tableHeadTD">开服时间</td>
                            <td class="tableHeadTD">礼包</td>
                            <td class="tableHeadTD">下载</td>
                        </tr>
                    </thead>
                    <tbody id="serverID"></tbody>
                </table>
            </div>
            <!-- 新游榜 -->
            <div class="tb hide" id="tb2"></div>
        </div>

        <!-- 下载模态框（Modal） -->
        <div id="modal">
            <div class="modal fade" id="downModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel"
                aria-hidden="true">
                <div class="modal-dialog white_content">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h4 class="modal-title" id="myModalLabel" style="text-align: center">下载游戏</h4>
                        </div>
                        <div class="modal-body">
                            <div class="modalBody">
                                <div class="top">
                                    <div class="left_img">
                                        <img src="#" class="downLoadImg" style="width: 96%;" class="gameImg" />
                                    </div>
                                    <div class="right_info">
                                        <p class="downloadName">${nameHTML}</p>
                                        <p style="line-height: 1.1rem;">
                                            <img src="images/angle.svg" />
                                            <img src="images/angle.svg" />
                                            <img src="images/angle.svg" />
                                            <img src="images/angle.svg" />
                                            <img src="images/angle.svg" />
                                        </p>
                                        <p class="downloadDescribe">${describe}</p>
                                    </div>
                                </div>
                                <div class="bottom">
                                    <a href="#" class="androidLoad android "><span><img src="images/android.svg"></span>安卓版下载</a>
                                    <a href="#" class="iOSLoad iOS "><span><img src="images/iOS.svg"></span>苹果版下载</a>
                                </div>
                            </div>
                        </div>
                        <div class="modal-footer flexCenterW">
                            <p data-dismiss="modal">关闭</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>


    </div>

</body>
<script src="https://cdn.bootcss.com/jquery/2.1.1/jquery.min.js"></script>
<script src="https://cdn.bootcss.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>

<script src="js/mui.min.js"></script>
<script src="js/layer.js"></script>
<script src="https://cdn.bootcss.com/blueimp-md5/2.10.0/js/md5.js"></script>
<script src="js/moment.min.js"></script>
<script src="./js/util/getSign.js"></script>
<script type="text/javascript" src="js/common.js"></script>
<!-- <script src="./js/pageJs/index.js"></script> -->

<script>
    var baseURL = 'http://192.168.2.159:7002'
    var _ref = ['/game/new-sort', '/game-server/index', '/game/recommend', '/gift-bag-user-cdkey/index', parseInt(
            moment().unix()), 'web'],
        newSortUrl = _ref[0],
        IndexUrl = _ref[1],
        recommendURL = _ref[2],
        CDKeydURL = _ref[3],
        now_time = _ref[4],
        platform = _ref[5];

    var signObj = {
        now_time: now_time,
        platform: platform
    };
    var sign = getSign(signObj); //调用签名函数获取签名
    var ajaxConfig = {
        platform: 'web',
        now_time: parseInt(moment().unix()),
        sign: getSign(signObj),
    }

    //公共参数
    $.ajaxSetup({
        type: 'GET',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
        },
        data: ajaxConfig,
    })
    //推荐游戏HTML
    $.ajax({
        url: baseURL + recommendURL,
        success: function (data) {
            if (data.data && data.data !== '') {
                remHTML(data.data)
                modalClick(data.data, 0)
            }
        },
        error: function (err) {
            console.log(err)
        },
    })


    var remHTML = function remHTML(data) {
        var remTempHTML = ''
        for (var i = 0; i < data.length; i++) {
            remTempHTML +=
                '<li class="list_content" data-toggle="modal" data-target="#downModal">' +
                '<div class="left_img">' +
                ' <img class="remLogo" src=' + data[i].logo + ' />' +
                '</div>' +
                '<div class="right_info">' +
                ' <p class="remName">' + data[i].name + '<img src="images/free.png" class="freeImg" class="icon"></p>' +
                '<p>' +
                '<img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                ' </p>' +
                '<p class="remDescribe">' + data[i].describe + '</p>' +
                '</div>' +
                '</li>'
        }
        $('.list_Body').html(remTempHTML)

    }
    // modal出来啦
    var modalClick = function (data, index) {
        if (index === 0) {
            $(document).delegate(".list_content", "click", function () {
                $('.downloadName').html(data[$(this).index()].name)
                $('.downloadDescribe').html(data[$(this).index()].describe)
                $('.downLoadImg').attr('src', data[$(this).index()].logo)
                $('.androidLoad').attr('href', data[$(this).index()].android_download_url)
                $('.iOSLoad').attr('href', data[$(this).index()].ios_download_url)
            });
        } 
        if(index === 0) {
            $(document).delegate(" .kaifuLi", "click", function () {
                $('.downloadName').html(data[$(this).index()].name)
                $('.downloadDescribe').html(data[$(this).index()].describe)
                $('.downLoadImg').attr('src', data[$(this).index()].logo)
                $('.androidLoad').attr('href', data[$(this).index()].android_download_url)
                $('.iOSLoad').attr('href', data[$(this).index()].ios_download_url)
            });
        }
        else {

        }
    }

    //开服请求
    $.ajax({
        url: baseURL + IndexUrl,
        success: function (data) {
            if (data.data && data.data !== '') {
                serverHTML(data.data)
                modalClick(data.data)
            }
        },
        error: function (err) {
            console.log(err)
        },
    })

    // 开服表
    var serverHTML = function remHTML(data) {
        console.log('开服表=>', data)

        var remTempHTML = ''
        data.map(function (item) {
            remTempHTML +=
                '<tr class="kaifuLi">' +
                '<td>' + item.name + '</td>' +
                '<td>' + item.opening_time + '</td>' +
                '<td class="gift_bag_id" data-indexCD=${i}><img src="images/gf.svg" class="gf" data-toggle="modal" data-target="#downModal"></td>' +
                '<td data-indexNEW=${i}><img src="images/download.svg" data-toggle="modal" data-target="#downModal"></td>' +
                '</tr>'

        })
        $('#serverID').html(remTempHTML)
    }

    $('.tabLi').on('click', 'li', function () {
        $(this).addClass('active').siblings().removeClass('active')
        if ($(this).hasClass('tb1')) {
            $("#tb1").show();
            $("#tb2").hide();
        } else {
            $("#tb2").show().removeClass('hide');
            $("#tb1").hide();
        }
    })

    function stopDefault(e) {
        if (e && e.preventDefault)
            e.preventDefault();
        else{
            window.event.returnValue = false;
        }
    }


    $("#nav").on('clcick', 'a', function (e) {
        stopDefault(e);
        console.log(1)
    })
    //新游戏
    $.ajax({
        url: baseURL + newSortUrl,
        success: function (data) {
            if (data.data && data.data !== '') {
                newSortHTML(data.data)
            }
        },
        error: function (err) {
            console.log(err)
        },
    })
    var newSortHTML = function newSortHTML(data) {
        var remTempHTML = ''
        data.map(function (item) {
            remTempHTML +=
                '<li class="content">' +
                '<div class="left">' +
                ' <img src="images/one.png" />' +
                '</div>' +
                '<div class="middle">' +
                '<div class="left_img">' +
                '<img src="" style="width: 90%;" />' +
                '</div>' +
                ' <div class="right_info">' +
                '<p class="d_name">' + item.name + '</p>' +
                '<p style="line-height: 1.1rem;">' +
                ' <img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                '<img src="images/angle.svg" />' +
                '</p>' +
                '<p class="d_describe">' + item.describe + '</p>' +
                ' </div>' +
                '</div>' +
                '<div class="right">' +
                '<button class="dlBtn" data-toggle="modal" data-target="#downModal">下载</button>' +
                ' </div>' +
                '</li>'
        })
        $('#tb2').html(remTempHTML)
    }
</script>

</html>